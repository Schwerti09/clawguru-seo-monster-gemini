name: Security Data Sync

on:
  schedule:
    # Run daily at 03:00 UTC â€“ fetches fresh CVEs from NVD and GitHub Advisory
    - cron: "0 3 * * *"
  workflow_dispatch:
    # Allow manual trigger from the GitHub Actions UI

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Trigger vulnerability sync
        run: |
          curl -s --fail-with-body \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            "${{ secrets.SITE_URL }}/api/agents/vulnerability"
        env:
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
          SITE_URL: ${{ secrets.SITE_URL }}
